<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Location Tracker</title>
</head>
<body>
    <h1>Send Your Location</h1>
    <button id="sendLocation">Send Location</button>
    <script>
        document.getElementById("sendLocation").addEventListener("click", () => {
            // Step 1: Get the Location
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    async (position) => {
                        const { latitude, longitude } = position.coords;

                        // Step 2: Get the IP Address
                        let ipData;
                        try {
                            const ipResponse = await fetch("https://api.ipify.org?format=json");
                            ipData = await ipResponse.json();
                        } catch (ipError) {
                            console.error("Error fetching IP:", ipError);
                            alert("Failed to get IP address.");
                            return;
                        }

                        // Step 3: Prepare Data for Sending
                        const data = {
                            ip: ipData.ip,
                            location: { latitude, longitude },
                            timestamp: new Date().toISOString(),
                        };

                        console.log("Data to Send:", data); // Debugging

                        // Step 4: Send Data to the Backend
                        try {
                            const response = await fetch(https://console.firebase.google.com/project/geolocator-e090c/usage/details, {
                                method: "POST",
                                headers: { "Content-Type": "application/json" },
                                body: JSON.stringify(data),
                            });

                            if (response.ok) {
                                console.log("Location data sent successfully!");
                                alert("Location sent successfully.");
                            } else {
                                throw new Error(`HTTP Error: ${response.status}`);
                            }
                        } catch (error) {
                            console.error("Error sending location data:", error);
                            alert("Failed to send location data.");
                        }
                    },
                    (error) => {
                        console.error("Error getting location:", error.message);
                        alert("Failed to get location. Please enable GPS.");
                    }
                );
            } else {
                alert("Geolocation is not supported by your browser.");
            }
        });
    </script>
</body>
</html>
